!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jQuery"),require("Masonry")):"function"==typeof define&&define.amd?define(["jQuery","Masonry"],t):e.Redgoose=t(e.$,e.Masonry)}(this,function(e,t){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t;function o(){return"ontouchstart"in window||navigator.maxTouchPoints}function n(e){return new Promise(function(t){window.timer&&clearTimeout(window.timer),window.timer=setTimeout(t,e)})}function i(e,...t){for(let o=0;o<t.length;o++){let n=`\\{${o}\\}`,i=new RegExp(n,"g");e=e.replace(i,t[o])}return e}const r=640;function s(){const t=this;this.$header=e(".layout-header"),this.$gnb=this.$header.find(".gnb");function n(){o()&&r<[window.innerWidth,window.innerHeight][0]&&t.$gnb.find(".gnb__dep-1 > li > div").prev().on("click",!1)}this.init=function(){n(),t.$header.find(".toggle-gnb").on("click",function(){e(this).toggleClass("toggle-gnb-active"),t.$gnb.toggleClass("gnb-active")})}}var l=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,o){function n(i,r){try{var s=t[i](r),l=s.value}catch(e){return void o(e)}if(!s.done)return Promise.resolve(l).then(function(e){n("next",e)},function(e){n("throw",e)});e(l)}return n("next")})}};const a=30,c=300,d=80,u=20;function p(o){let n=(()=>{var t=l(function*(t){let n=null;s(!1);try{n=yield e.ajax({url:`${o.options.root}/ajax/`,type:"post",data:{page:t,size:i.options.size,field:"srl,title,category_srl,json"},dataType:"json"})}catch(e){return alert("Server error"),console.error(e),s(!0),!1}return function(t,n=!1,r=!1){t.nextpage||i.$more.remove();if(!t.articles||!t.articles.length)return;let s=t.articles.map((e,t)=>{let n=`${o.options.root}/article/${i.options.nest||""}${e.srl}`,r=`${o.options.gooseRoot}/${e.json.thumbnail.url}`,s=`grid-item grid-item__hidden ${e.size_className}`;return`<div class="${s}">`+`<a href="${n}" data-srl="${e.srl}" title="${e.title}">`+`<figure style="background-image: url('${r}')">`+`${e.title}`+"</figure></a></div>"}).join(""),l=e(s);f(l.children("a")),i.$articles.append(l),i.masonry&&i.masonry.appended(l);n&&l.each(function(t){setTimeout(()=>{e(this).removeClass("grid-item__hidden")},d*t)});if(r){let o=l.eq(0),n=o.offset().top-a;o.attr("data-page",t.currentPage),e("html, body").stop().animate({scrollTop:n},c,"swing")}}(n,!0,!0),i.$more.children("a").attr("data-next",n.nextpage),i.masonry&&i.masonry.layout(),s(!0),!1});return function(e){return t.apply(this,arguments)}})();const i=this;this.srls={},this.options={},this.scrollTimer=null,this.selector_articles="#articles",this.$index=e(".index"),this.$articles=this.$index.find(".index__articles"),this.$category=this.$index.find(".index__categories"),this.$more=this.$index.find(".index__loadMore"),this.masonry=null;function r(e=!0){e?(i.$articles.addClass("masonry"),i.masonry=new t(i.selector_articles,{itemSelector:".grid-item",columnWidth:".grid-sizer",transitionDuration:"0s",hiddenStyle:{},visibleStyle:{}})):(i.$articles.removeClass("masonry"),i.masonry.destroy(),i.masonry=null)}function s(e){function t(){return n(this.dataset.next).then(),!1}e?(i.$more.children("a").on("click",t),i.$more.removeClass("loadMore-loading")):(i.$more.children("a").off("click"),i.$more.addClass("loadMore-loading"))}function p(){e(this).toggleClass("categories__toggle-active"),e(this).next().toggleClass("categories__index-active")}function h(t){if(!o.options.dynamicChangePageNumber)return;function n(){const t=i.$articles.children("[data-page]"),n=e(this).scrollTop();let r=null;if(!t.length)return!1;n+e(this).height()===e(document).height()?r=t.eq(t.length-1)?t.eq(t.length-1):null:(t.each(function(t){n>=e(this).offset().top-(a+5)&&(r=e(this))}),r||(r=t.eq(0)));!function(e){if(!URL)return;let t=new URL(window.location.href),n=t.searchParams,i=t.searchParams.get("page");if(i=i?parseInt(i):1,e===i)return;1===e?n.delete("page"):n.set("page",e);let r=location.pathname+(n.toString()?`?${n.toString()}`:"");o.history.replace({url:r,type:"index"},null,r)}(r&&r.length?r.data("page"):1)}t?(e(window).off("scroll.redgoose"),e(window).on("scroll.redgoose",function(){clearTimeout(i.scrollTimer),i.scrollTimer=setTimeout(n,100)})):e(window).off("scroll.redgoose")}function f(t){function n(){i.destroyIndexEvent()}t.on("click",function(t){let i=e(this).data("srl");return i&&o.article.open(i,!0).then(n),!1})}this.init=function(e={}){if(!this.$articles.length)return!1;this.srls.nest=e.nest_srl,this.srls.category=e.category_srl,this.options.size=e.size||u,this.options.title=e.title||o.options.title,o.mode="index",this.$category.children(".categories__toggle").on("click",p),f(this.$articles.find(".grid-item > a")),o.history.initPopEvent(),r(),i.$more.children("a").attr("href","javascript:;"),s(!0),h(!0)},this.pushPage=function(e){n(e).then()},this.destroyIndexEvent=function(){this.masonry&&r(!1),h(!1)},this.restoreIndexEvent=function(){this.masonry||r(!0),h(!0)},this.useMasonry=function(e){r(e)},this.useScrollEvent=function(e){h(e)}}const h={en:{msg_notFound:"Not found {0}",msg_errorIndexMode:"It is not currently in 'index' mode.",msg_errorArticleMode:"It is not currently in 'article' mode.",msg_notAvailablePopupMode:"Not available in pop-up mode."},ko:{msg_notFound:"{0} 값이 없습니다.",msg_errorIndexMode:"지금은 'index'모드가 아닙니다.",msg_errorArticleMode:"지금은 'article'모드가 아닙니다.",msg_notAvailablePopupMode:"팝업모드에서는 사용할 수 없습니다."}};var f=h[navigator.language]||h.en;function g(t){let o=(()=>{var o=l(function*(o,n=!1){return o?"index"!==t.mode?(alert(f.msg_errorIndexMode),null):t.$popup&&t.$popup.length?(t.mode="article",s.backupIndexScrollTop=e(window).scrollTop(),t.$popup.addClass("popupArticle-show"),t.$app.addClass("disabled"),window.scrollTo(0,0),yield a(o,n,"push"),void u(!0)):(t.options.dev&&console.error(i(f.msg_notFound,"popup element")),null):(alert(i(f.msg_notFound,"'srl'")),null)});return function(e){return o.apply(this,arguments)}})(),r=(()=>{var o=l(function*(o=!1){"article"===t.mode?(t.mode="index",o&&window.history.back(),s.srl=null,t.$popup&&t.$popup.length&&(t.$app.removeClass("disabled").addClass("hidden"),t.$popup.removeClass("popupArticle-show").empty(),t.index.restoreIndexEvent(),yield n(10),t.index&&t.index.masonry.layout(),yield n(10),e("html,body").scrollTop(s.backupIndexScrollTop),s.backupIndexScrollTop=0,t.$app.removeClass("hidden"),u(!1)),t.index&&t.index.options&&(document.title=t.index.options.title)):alert(f.msg_errorArticleMode)});return function(){return o.apply(this,arguments)}})();const s=this;e("html");this.backupIndexScrollTop=0,this.$close=null,this.$prev=null,this.$next=null,this.$like=null,this.$body=null,this.srl=null;function a(o,n=!1,i="push"){return new Promise(function(l){const a=`${t.options.root}/article/${o}/`;t.$popup&&(d(!0),s.srl=o,t.$popup.empty(),t.$popup.load(`${a}?mode=popup`,u=>{let p=e(u).find(".article__header > h1").text();p=p?`${t.options.title} / ${p}`:t.options.title,s.$body=e("#article"),s.$close=e("#closeArticle"),s.$prev=e("#goToPrevArticle"),s.$next=e("#goToNextArticle"),s.$like=e("#toggleLike"),function(e=!0){e?s.$close.on("click",()=>r(!0)):s.$close.off("click")}(),c(),function(e=!0){function t(){return s.go(this.dataset.srl,!0,"replace"),!1}e?(s.$prev.on("click",t),s.$next.on("click",t)):(s.$prev.off("click"),s.$next.off("click"))}(),n&&(t.options.dev&&console.warn("change url:",a,i),t.history[i||"push"]({url:a,srl:o,type:"article"},p,a)),d(!1),l()}))})}function c(){let o=(()=>{var o=l(function*(o){return o?yield e.ajax({url:`${t.options.root}/ajax/uplike/`,type:"post",headers:{"redgoose-action":"uplike"},data:{srl:o},dataType:"json"}):null});return function(e){return o.apply(this,arguments)}})();function n(){const e=s.$like.children("em");let t=this.dataset.srl,i=parseInt(e.text());s.$like.addClass("onLike-on").off(),e.text(i+1),o(t).then(function(t){switch(t.state){case"success":break;case"error":e.text(i),s.$like.removeClass("onLike-on").on("click",n),console.error(t.message)}})}s.$like.hasClass("onLike-on")||(s.$like.off("click"),s.$like.on("click",n))}function d(t=!1){if(t){let t=e('<div class="loading" id="loading"><div class="spinner"></div></div>');e("body").append(t)}else e("#loading").remove()}function u(o){const n=e(window),i={left:37,right:39,esc:27,cmd:91,ctrl:17};let r=!0;function l(e){switch(e.keyCode){case i.cmd:case i.ctrl:r=!0;break;case i.left:r&&s.prev();break;case i.right:r&&s.next();break;case i.esc:t.$popup&&s.close(!0)}}function a(e){switch(e.keyCode){case i.left:case i.right:r=!0;break;default:r=!1}}o?(n.off("keyup.redgoose keydown.redgoose"),n.on("keyup.redgoose",l),n.on("keydown.redgoose",a)):n.off("keyup.redgoose keydown.redgoose")}this.open=(()=>{var e=l(function*(e,t=!1){yield o(e,t)});return function(t){return e.apply(this,arguments)}})(),this.close=(()=>{var e=l(function*(e){yield r(e)});return function(t){return e.apply(this,arguments)}})(),this.go=function(e,o,n="push"){e?"article"===t.mode&&t.index&&t.$popup?a(e,o,n).then():window.location.href=`${t.options.root}/article/${e}/`:alert(i(f.msg_notFound,"'srl'"))},this.prev=function(){try{if(!s.$prev||!s.$prev.length)throw i(f.msg_notFound,"article");let e=s.$prev.get(0).dataset.srl;if(!e)throw i(f.msg_notFound,"article srl");this.go(e,!0,"replace")}catch(e){return t.options.dev&&console.error(e),!1}},this.next=function(){try{if(!s.$next||!s.$next.length)throw i(f.msg_notFound,"article");let e=s.$next.get(0).dataset.srl;if(!e)throw i(f.msg_notFound,"article srl");this.go(e,!0,"replace")}catch(e){return t.options.dev&&console.error(e),!1}},this.init=function(o){return t.$popup&&t.$popup.length?(t.options.dev&&console.error(f.msg_notAvailablePopupMode),null):o&&o.srl?(delete t.index,delete t.popup,delete t.$popup,this.srl=parseInt(o.srl),t.mode="article",this.$body=e("#article"),this.$prev=e("#goToPrevArticle"),this.$next=e("#goToNextArticle"),this.$like=e("#toggleLike"),t.history.initPopEvent(),c(),void u(!0)):(console.error(i(f.msg_notFound,"article srl")),null)}}const m={root:"",gooseRoot:"",dynamicChangePageNumber:!0,dev:!1};return function(t){this.$app=e("main"),this.popup="popupArticle",this.$popup=e(`#${this.popup}`),this.mode=null,this.options=Object.assign({},m,t),this.history=new function(t){const o=e("head > title");function n(){return!!history.pushState}this.push=function(e,t,i){n()&&i&&(t&&o.text(t),history.pushState(e||null,t||i,i))},this.replace=function(e,t,i){n()&&i&&(t&&o.text(t),history.replaceState(e||null,t||i,i))},this.initPopEvent=function(){function e(e){const o=e.state;if(o&&o.type)switch(o.type){case"index":if("article"===t.mode){if(t.article.srl)return t.article.close(),!1;if(!t.index)return location.reload(),!1}return!1;case"article":if("index"===t.mode&&o.srl)return t.article.open(o.srl),!1;if("article"===t.mode&&t.article.srl!==o.srl)return t.article.go(o.srl),!1;break;default:return"article"===t.mode&&t.$popup?(t.article.close(),!1):(location.reload(),!1)}else{if("article"===t.mode&&t.$popup)return t.article.close(),!1;if("index"===t.mode&&t.$popup)return!1}return location.reload(),!1}n()&&(window.removeEventListener("popstate",e),window.addEventListener("popstate",e))}}(this),this.header=new s(this),this.index=new p(this),this.article=new g(this),o()&&e("html").addClass("touch"),function(e){if(!e)return null;t=window,o=document,n=void 0,i=void 0,t.GoogleAnalyticsObject="ga",t.ga=t.ga||function(){(t.ga.q=t.ga.q||[]).push(arguments)},t.ga.l=1*new Date,n=o.createElement("script"),i=o.getElementsByTagName("script")[0],n.async=1,n.src="//www.google-analytics.com/analytics.js",i.parentNode.insertBefore(n,i);var t,o,n,i;ga("create","UA-42563094-1","redgoose.me"),ga("send","pageview")}(!t.dev)}});
